<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Performance Marketing GPT</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
.typing::after { content:"▋"; animation:blink 1s infinite; }
@keyframes blink { 50%{opacity:0} }
</style>
</head>

<body class="bg-gray-100 dark:bg-slate-900 text-gray-900 dark:text-gray-100">

<div class="max-w-3xl mx-auto p-4">

<h1 class="font-bold text-xl mb-4">Performance Marketing GPT</h1>

<div id="chat" class="space-y-4 mb-4"></div>

<textarea id="input"
  class="w-full p-3 rounded-lg border dark:bg-slate-800"
  placeholder="Ask about PMax, ROAS, SEO, CRO, strategy…"
  onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();send()}">
</textarea>

<p class="text-xs opacity-40 mt-6 text-center">
Powered by Listan Dsouza
</p>
</div>

<script>
const API = "https://performance-marketing-api.listandsouza.workers.dev";
const MODEL = "openai/gpt-oss-120b";

let messages = [];

function intent(q){
  q=q.toLowerCase();
  if(q.includes("pmax")) return "Performance Max";
  if(q.includes("seo")) return "SEO";
  if(q.includes("cro")||q.includes("conversion")) return "CRO";
  return "Marketing Strategy";
}

function clarify(q,i){
  if(i==="Performance Max"&&!q.match(/\d|\$/))
    return "What is your **daily budget and target CPA**?";
  if(i==="SEO"&&!q.includes("site"))
    return "Which **website or niche** is this for?";
  if(i==="CRO"&&!q.includes("traffic"))
    return "What is your **monthly traffic and conversion rate**?";
  return null;
}

async function send(){
  const input=document.getElementById("input");
  const text=input.value.trim();
  if(!text) return;
  input.value="";

  messages.push({role:"user",content:text});
  render();

  const i=intent(text);
  const c=clarify(text,i);
  if(c){
    messages.push({role:"assistant",content:c});
    render();
    return;
  }

  messages.push({role:"assistant",content:"Thinking…",typing:true});
  render();

  try{
    const res=await fetch(API,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        model:MODEL,
        messages:[
          {role:"system",content:`You are a ${i} expert.`},
          ...messages.filter(m=>!m.typing)
        ]
      })
    });

    const data=await res.json();
    messages.pop();
    messages.push({role:"assistant",content:data.choices[0].message.content});
  }catch{
    messages.pop();
    messages.push({role:"assistant",content:"Strategy fails when assumptions are wrong. Clarify inputs before scaling."});
  }

  render();
}

function render(){
  document.getElementById("chat").innerHTML=messages.map(m=>`
    <div class="${m.role==="user"?"text-right":""}">
      <div class="inline-block p-3 rounded-lg bg-white dark:bg-slate-800 prose dark:prose-invert ${m.typing?"typing":""}">
        ${marked.parse(m.content)}
      </div>
    </div>
  `).join("");
}
</script>

</body>
</html>
